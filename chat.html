<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Chat với Em (AI)</title>
  <style>
    body {margin:0; font-family:"Segoe UI", Arial; background:#eceff1;
          display:flex; align-items:center; justify-content:center; height:100vh;}
    .chatbox {width:380px; height:600px; background:#fff; border-radius:20px;
              box-shadow:0 8px 28px rgba(0,0,0,0.15); display:flex; flex-direction:column; overflow:hidden;}
    .header {background:#0084ff; color:#fff; padding:14px; font-weight:600; text-align:center;}
    .messages {flex:1; padding:12px; display:flex; flex-direction:column; gap:10px; overflow-y:auto; background:#f5f5f5;}
    .msg {max-width:75%; padding:10px 14px; border-radius:18px; line-height:1.4; font-size:15px;
          word-wrap:break-word; animation:fadeInUp .3s ease;}
    .me {align-self:flex-end; background:#0084ff; color:#fff; border-bottom-right-radius:4px;}
    .her {align-self:flex-start; background:#e0e0e0; border-bottom-left-radius:4px;}
    @keyframes fadeInUp {from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);}}
    .input {padding:10px; display:flex; gap:8px; border-top:1px solid #ddd; background:#fafafa;}
    .input input {flex:1; border:1px solid #ccc; border-radius:10px; padding:8px 12px; font-size:14px; outline:none;}
    .input button {border:none; border-radius:10px; padding:8px 14px; font-size:14px; font-weight:600; cursor:pointer;
                  background:linear-gradient(90deg,#6fe7c4,#8bd3ff); color:#023; transition:transform .15s;}
    .input button:hover {transform:scale(1.05);}
  </style>
</head>
<body>
  <div class="chatbox">
    <div class="header">💬 Chat với Em (AI)</div>
    <div class="messages" id="messages">
      <div class="msg her">Xin chào, anh định nhắn gì thế? 😊</div>
    </div>
    <div class="input">
      <input type="text" id="textInput" placeholder="Nhập tin nhắn...">
      <button onclick="sendMessage()">Gửi</button>
    </div>
  </div>

  <script>
    const chat = document.getElementById("messages");
    const input = document.getElementById("textInput");

    function addMessage(text, who) {
      const msg = document.createElement("div");
      msg.className = "msg " + who;
      msg.innerText = text;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;

      addMessage(text, "me");
      input.value = "";

      const thinking = document.createElement("div");
      thinking.className = "msg her";
      thinking.innerText = "Đang trả lời...";
      chat.appendChild(thinking);
      chat.scrollTop = chat.scrollHeight;

      try {
        const response = await fetch("http://localhost:3000/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages: [{ role: "user", content: text }] })
        });
        const data = await response.json();
        chat.removeChild(thinking);
        const reply = data.choices[0].message.content;
        addMessage(reply, "her");
      } catch (err) {
        chat.removeChild(thinking);
        addMessage("Em bị lỗi mất rồi 😢", "her");
        console.error(err);
      }
    }

    input.addEventListener("keypress", e => {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>
